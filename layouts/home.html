{{ define "advocate-icon-images" }}
{{ range cond (not (eq .Section "tv")) .Params.team .Params.hosts }}
{{ with $.Site.GetPage (print "/team/" (urlize .) ) }}
<img src='{{ partial "image-src.html" (dict "context" . "process" "fill" "size" "45x45") }}' alt="{{ .Params.name }}"
    class="rounded-circle m-1">
<p class="d-inline-block">{{ .Params.name }}</p>
{{ end }}
{{ end }}
{{ end }}

{{ define "main" }}

{{/* VARS */}}
{{ $advocatePages := where (where .Site.Pages "Section" "team") "Params.roles" "intersect" (slice "advocate")}}
{{ $advocates := slice }}
{{ range $advocatePages }}
{{ $advocates = $advocates | append .Params.name }}
{{ end }}
{{ $latestContent := sort (where .Site.RegularPages "Params.hosts" "intersect" $advocates | union (where
.Site.RegularPages "Params.team" "intersect" $advocates) ) "Date"
"desc" }}
{{ $latestContent = where $latestContent "Date" "le" now }}
{{ $latestContent = first 3 $latestContent }}

<h1 class='d-none'>{{ .Title }} Homepage</h1>

<section id="hero" class="td-box td-box--primary position-relative td-box--height-auto overflow-hidden">
    <div id="home-featured" class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center m-4">{{ .Params.tagline }}</h1>
            </div>
            <p class="mt-4">{{ .Params.description }}</p>
            <div class="container py-5 px-0">
                <h2 class="text-center">Featured</h2>
                <div class="row mt-4">
                    {{ range .Params.featured }}
                    {{ with $.Site.GetPage (print .) }}
                    <div class="col-12 col-lg-4 td-box--gray-dark subtopic mr-3 mb-3 flex-315 transition-all">
                        <div class="gradient-edge-left"></div>
                        <a class="linked-box td-box--gray-dark p-4 position-relative" href="{{ .RelPermalink }}">
                            <div class="card-type-id">
                                <img alt="" class="d-inline-block"
                                    src='{{ printf "images/icons/icon-%s-label.svg" .Type | relURL }}'>
                                <span class="h5">{{ .Section }}</span>
                            </div>
                            <p class="link">{{ .Title }}</p>
                        </a>
                        {{ template "advocate-icon-images" .}}
                    </div>
                    {{ end }}
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</section>

<section id="home-latest" class="td-box">
    <div id="home-latest" class="container">
        <div class="col-12">
            <h2 class="text-center m-4 pb-4">Latest Content</h2>
        </div>
        <div class="row mt-5">
            {{ range $latestContent }}
            <div class="col-12 col-lg-4 pb-4">
                {{ partial (printf "%s-card.html" .Section) . }}
                {{ template "advocate-icon-images" .}}
            </div>
            {{ end }}
        </div>
    </div>
</section>

<section class="td-box td-box--gray-dark td-box--gradient td-box--height-auto">
    <h2 id="home-advocates" class="text-center mb-4">Our Developer <a
            href="{{ (.Site.GetPage `advocates`).RelPermalink }}">Advocates</a></h2>
    <div class="container-fluid">
        <div id="advocate-panel" class="row d-flex flex-row flex-nowrap overflow-auto">
            {{ range $advocatePages }}
            <div class="col-12 col-lg-4 td-box--gray-dark mr-3 mb-3 flex-315 transition-all">
                <a href="{{ .RelPermalink }}" class="linked-box td-box--gray-dark">
                    <img src="{{ partial `image-src.html` (dict `context` . `process` `resize` `size` `600x600`) }}"
                        alt="{{ .Params.name }} Image" class="card-img-top">
                    <div class="card-body">
                        <h5 class="card-title" style="color:white">{{ .Params.name }}</h5>
                    </div>
                </a>
            </div>
            {{ end }}
        </div>
    </div>
    </div>
</section>
{{ $carouselScript := resources.Get "js/home_carousel.js" }}
<script src="{{ $carouselScript.RelPermalink }}"></script>

<script>sendAmplitudeEventOnLoad('home viewed', { 'url path': window.location.pathname });</script>

{{ with .Content }}
{{ . }}
{{ end }}

{{ end }}