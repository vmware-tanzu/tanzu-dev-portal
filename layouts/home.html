{{/* TEMPLATES */}}
{{ define "advocateCard" }}
{{ $image := "" }}
{{ if .Params.photo }}
{{ $image = .Resources.Get (print "images/" (.Params.photo)) }}
{{ else }}
{{ $image = .Resources.Get (print "images/" (urlize .Params.name) ".jpg") }}
{{ end }}
{{ $image = $image.Resize "600x600" }}
<div class="col-12 col-lg-4">
    <a href="{{ .RelPermalink }}">
        <div class="card">
            <img src="{{ $image.RelPermalink }}" alt="{{ .Params.name }} Image" class="card-img-top">
            <div class="card-body">
                <h5 class="card-title" style="color:black">{{ .Params.name }}</h5>
            </div>
            <div class="card-footer">
                <small class="text-muted">{{ range .Params.skills }}{{ . }} {{ end }}</small> {{/*TODO Add icons for
                skills in footer Or remove footer altogether?*/}}
            </div>
        </div>
    </a>
</div>
{{ end }}

{{ define "main" }}

{{/* VARS */}}
{{ $advocatePages := where (where .Site.Pages "Section" "team") "Params.roles" "intersect" (slice "advocate")}}
{{ $advocates := slice }}
{{ range $advocatePages }}
{{ $advocates = $advocates | append .Params.name }}
{{ end }}
{{ $showPages := sort (where (where .Site.RegularPages "Section" "tv") "Params.hosts" "intersect" $advocates) "Date"
"desc" }}
{{ $showPages = where $showPages "Date" "le" now }}
{{ $showPages = first 3 $showPages }}
{{ $contentPages := first 3 (sort (where $.Site.RegularPages "Params.team" "intersect" $advocates) "Date" "desc" ) }}

<h1 class='d-none'>{{ .Title }} Homepage</h1>

<section id="hero" class="td-box td-box--primary position-relative td-box--height-auto overflow-hidden">
    <div id="home-featured" class="container">
        <div class="row text-center">
            <div class="col-12">
                <h1>{{ .Params.tagline }}</h1>
            </div>
            <p>{{ .Params.description }}</p>
            <div class="container py-5 px-0">
                <div class="row">
                    {{ range $showPages }}
                    {{ partial "tv-card" . }}
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</section>

<section id="home-latest" class="td-box">
    <h2 class="text-center">Latest Advocate Content</h2>
    <div id="home-latest" class="container">
        <div class="row">
            {{ range $contentPages }}
            <div class="col-4">
                {{ partial (printf "%s-card.html" .Section) . }}
                {{ range .Params.team }}
                {{ with $.Site.GetPage (print "/team/" (urlize .) ) }}
                <img src='{{ partial "image-src.html" (dict "context" . "size" "150x150") }}' alt="{{ .Params.name }}" class="d-inline-block rounded-circle w-25 mr-4"><p class="d-inline-block">{{ .Params.name }}</p>
                {{ end }}
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</section>

<section class="td-box td-box--gray-dark td-box--gradient td-box--height-auto">
    <h2 id="home-advocates" class="text-center">Our Developer Advocates</h2>
    <div class="container-fluid">
        <div id="advocate-panel" class="row d-flex flex-row flex-nowrap overflow-auto">
            {{ range $advocatePages }}
            {{ template "advocateCard" . }}
            {{ end }}
        </div>
    </div>
    </div>
</section>
{{ $carouselScript := resources.Get "js/carousel.js" }}
<script src="{{ $carouselScript.RelPermalink }}"></script>

<script>sendAmplitudeEventOnLoad('home viewed', { 'url path': window.location.pathname });</script>

{{ with .Content }}
{{ . }}
{{ end }}

{{ end }}